matrix:
  include:
    # backend jest tests
    - language: node_js
      node_js:
          - "lts/*"
      services:
          - mongodb
      env:
        - NODE_ENV=test
      install:
        - npm cache clean
        - npm install
      script:
        - npm test

    # e2e tests
    - language: node_js
      node_js:
          - "lts/*"
      services:
          - mongodb
      addons:
        - chrome: stable
      env:
        - NODE_ENV=test

      before_install:
        - npm cache clean
        - npm install
        - npm run start
        - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &
      install:
        - cd frontend
        - npm install
      script:
        - npm run e2e
