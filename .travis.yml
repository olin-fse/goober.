cache:
  directories:
  - node_modules

matrix:
  include:
    # backend jest tests
    - language: node_js
      node_js:
          - "lts/*"
      services:
          - mongodb
      env:
        - NODE_ENV=test
      install:
        - npm install
      script:
        - npm test

    # e2e tests
    - language: node_js
      node_js:
          - "lts/*"
      services:
          - mongodb
      dist: trusty
      sudo: required
      addons:
        - chrome: stable
      env:
        - NODE_ENV=test
      before_install:
        - npm install
        - npm run server
        - export CHROME_BIN=/usr/bin/google-chrome
        - export DISPLAY=:99.0
        - sh -e /etc/init.d/xvfb start
        - sudo apt-get update
        - sudo apt-get install -y libappindicator1 fonts-liberation
        - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        - sudo dpkg -i google-chrome*.deb
        - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &
      install:
        - cd frontend
        - npm install
      script:
        - npm run e2e
